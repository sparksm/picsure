!function(a){"use strict";console.log(a),a.picsure=function(b,c){this.$element=a(c),this.options=b,this.num=Math.round(1e20*Math.random()),this.density=+window.devicePixelRatio||1,this.imageSetCss=function(){var a=document.createElement("div");return a.style.backgroundImage="",a.style.backgroundImage="-webkit-image-set(url() 1x)",""!==a.style.backgroundImage?!0:!1}(),this.oneEm=function(){var b=a("<div/>").css({position:"absolute",bottom:-1e3,right:-1e3,border:"none",margin:0,padding:0,width:"1em"}).appendTo(a("body")),c=b.width();return b.remove(),c}(),this.original=this.$element.attr("src"),this.setOptions(),this.set=this.parseParams(),this.setPassed(this.tester(this.set)),this.options.picture||this.bind()},a.picsure.settings={picture:!1,fluid:!1},a.picsure.prototype={bind:function(){var b=this;a(window).on("resize",function(){b.setPassed(b.tester(b.set))}),a(document).on("load","img",function(){b.setPassed(b.tester(b.set))})},setOptions:function(){this.options=a.extend(!0,{},this.settings,this.options)},pickBest:function(b){var c=b[0].pass,d={};return a.each(b,function(a){var e=b[a];d[e.type]||(d[e.type]=e),e.value<d[e.type].value&&(d[e.type]=e,c=e.pass)}),d.w&&d.h&&(c=a(window).width()>a(window).height()?d.w.pass:d.h.pass),c},setPassed:function(a){var b=this;if(0===a.length)return b.$element.attr("src")!==b.original&&b.$element.attr("src",b.original),void 0;var c=b.pickBest(a);b.$element.attr("src")!==c&&b.$element.attr("src",c)},parseSrcset:function(b,c){var d=a.trim(b);if(!d.match(" ")&&!c)return d;var e=d.split(","),f=[];return a.each(e,function(b){c&&a.each(c,function(a){"max"===c[a].minMax&&(e[b]=e[b]+" "+c[a].value+c[a].type)});var d="",g=[],h=a.trim(e[b]).split(" ");a.each(h,function(a){if(0===a)return d=h[a],void 0;var b=h[a][h[a].length-1];b.match(/[whx]/)&&g.push({type:b,value:+h[a].slice(0,h[a].length-1),pass:d})}),f.push(g)}),f},parseParams:function(){if(!this.options.picture){var b=a.trim(this.$element.attr("srcset"));return this.parseSrcset(b)}this.$element.addClass("picsure_"+this.num);var c=this,d=this.$element.find("source");a.each(d,function(b){var e=a(d[b]),f=e.attr("media"),g=e.attr("srcset");"undefined"!=typeof f&&""!==f&&(f=c.parseMedia(f)),console.log(f,c.parseSrcset(g,f))})},parseMedia:function(b){var c=this,d=a.trim(b),e=d.split("and"),f=[];return a.each(e,function(b){var d=a.trim(e[b]),g=a.trim(d.split(":")[0]);-1!==g.indexOf("(")&&(g=g.slice(g.indexOf("(")+1));var h=a.trim(d.split(":")[1]);-1!==h.indexOf(")")&&(h=h.slice(0,h.indexOf(")")));var i=h.match(/(\d.*?)(?!\d)/),j=h.substring(h.indexOf(i[0])+i[0].length,h.length);i=+h.substring(h.indexOf(i[0]),i[0].length);var k=g.split("-")[0]||"max";"em"===j&&(i*=c.oneEm);var l=g.split("-")[1]||"width";l="height"===l?"h":"w",f.push({minMax:k,value:i,type:l})}),f},tester:function(b){var c=this,d=[];return a.each(b,function(e){var f=!0;a.each(b[e],function(a){var d=b[e][a];c.testCondition(d)||(f=!1)}),f&&d.push(b[e][0])}),d},testCondition:function(b){switch(b.type){case"w":return a(window).width()<b.value?!0:!1;case"h":return a(window).height()<b.value?!0:!1;case"x":return this.density===b.value?!0:!1;default:return!1}}},a.fn.picsure=function(b){if("string"==typeof b){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=a.data(this,"picsure");return d?a.isFunction(d[b])?(d[b].apply(d,c),void 0):(a.error('No such method "'+b+'"'),void 0):(a.error('Cannot call "'+b+'" method prior to initialization.'),void 0)})}else this.each(function(){var c=a.data(this,"picsure");c&&c.destroy(),a.data(this,"picsure",new a.picsure(b,this))});return this},a(function(){var b=a("img:not(picture img)");b.picsure()})}(jQuery);